{"version":3,"sources":["../src/highlights.js"],"names":["highlights","insert","delete","selectByDocumentAndUser","router","Router","get","req","res","query","format","params","documentId","userId","error","results","fields","console","log","sendStatus","json","body","user","id","post","start","end","class","container"],"mappings":";;;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAIA,aAAa;AACfC,UACA;kCAFe;AAIfC,UACA;;;qBALe;AASfC,2BACA;;;;AAVe,CAAjB;;AAgBA,IAAIC,SAAS,kBAAQC,MAAR,EAAb;;AAEA;AACAD,OAAOE,GAAP,CAAW,sBAAX,EAAmC,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC/C,eAASC,KAAT,CAAe,gBAAMC,MAAN,CAAaV,WAAWG,uBAAxB,EACb,CACEI,IAAII,MAAJ,CAAWC,UADb,EAEEL,IAAII,MAAJ,CAAWE,MAFb,CADa,CAAf,EAME,UAACC,KAAD,EAAQC,OAAR,EAAiBC,MAAjB,EAA4B;AAC1B,QAAIF,KAAJ,EAAW;AACTG,cAAQC,GAAR,CAAYJ,KAAZ;AACAN,UAAIW,UAAJ,CAAe,GAAf;AACA;AACD;AACDF,YAAQC,GAAR,CAAYH,OAAZ;AACAP,QAAIY,IAAJ,CAASL,OAAT;AACD,GAdH;AAgBD,CAjBD;;AAmBA;AACAX,OAAOF,MAAP,CAAc,GAAd,EAAmB,UAACK,GAAD,EAAMC,GAAN,EAAc;AAC/B,MAAID,IAAIc,IAAJ,CAASR,MAAT,IAAmBN,IAAIe,IAAJ,CAASC,EAAhC,EAAoC;AAClC,iBAASd,KAAT,CAAe,gBAAMC,MAAN,CAAaV,WAAWE,MAAxB,EACb,CACEK,IAAIc,IAAJ,CAASE,EADX,EAEEhB,IAAIc,IAAJ,CAAST,UAFX,EAGEL,IAAIc,IAAJ,CAASR,MAHX,CADa,CAAf,EAOE,UAACC,KAAD,EAAQC,OAAR,EAAiBC,MAAjB,EAA4B;AAC1B,UAAIF,KAAJ,EAAW;AACTG,gBAAQC,GAAR,CAAYJ,KAAZ;AACAN,YAAIW,UAAJ,CAAe,GAAf;AACA;AACD;AACDF,cAAQC,GAAR,CAAYF,MAAZ;AACAR,UAAIW,UAAJ,CAAe,GAAf;AACD,KAfH;AAiBD,GAlBD,MAkBO;AACLX,QAAIW,UAAJ,CAAe,GAAf,EADK,CACgB;AACtB;AACF,CAtBD;;AAwBA;AACAf,OAAOoB,IAAP,CAAY,GAAZ,EAAiB,UAACjB,GAAD,EAAMC,GAAN,EAAc;AAC7B,MAAID,IAAIc,IAAJ,CAASR,MAAT,IAAmBN,IAAIe,IAAJ,CAASC,EAAhC,EAAoC;;AAElC;AACA,iBAASd,KAAT,CAAe,gBAAMC,MAAN,CAAaV,WAAWC,MAAxB,EACb,CACEM,IAAIc,IAAJ,CAASE,EADX,EAEEhB,IAAIc,IAAJ,CAASI,KAFX,EAGElB,IAAIc,IAAJ,CAASK,GAHX,EAIEnB,IAAIc,IAAJ,CAASM,KAJX,EAKEpB,IAAIc,IAAJ,CAASO,SALX,EAMErB,IAAIc,IAAJ,CAAST,UANX,EAOEL,IAAIc,IAAJ,CAASR,MAPX,CADa,CAAf,EAWE,UAACC,KAAD,EAAQC,OAAR,EAAiBC,MAAjB,EAA4B;AAC1B,UAAIF,KAAJ,EAAW;AACTG,gBAAQC,GAAR,CAAYJ,KAAZ;AACAN,YAAIW,UAAJ,CAAe,GAAf;AACA;AACD;AACDF,cAAQC,GAAR,CAAYH,OAAZ;AACAP,UAAIW,UAAJ,CAAe,GAAf;AACD,KAnBH;AAqBD,GAxBD,MAwBO;AACLX,QAAIW,UAAJ,CAAe,GAAf,EADK,CACgB;AACtB;AACF,CA5BD;;kBA8Bef,M","file":"highlights.js","sourcesContent":["\nimport express from 'express';\nimport dbIniter from './db/db';\nimport mysql from 'mysql';\n\nlet highlights = {\n  insert:\n  'INSERT INTO highlights \\\n     VALUES (?, ?, ?, ?, ?, ?, ?)',\n  delete:\n  'DELETE FROM highlights \\\n     WHERE id = ? \\\n     AND document_id = ? \\\n     AND user_id = ?',\n  selectByDocumentAndUser:\n  'SELECT * \\\n     FROM highlights \\\n     WHERE document_id = ? \\\n     AND user_id = ?',\n}\n\nlet router = express.Router();\n\n// get highlights by document and user\nrouter.get('/:documentId/:userId', (req, res) => {\n  dbIniter.query(mysql.format(highlights.selectByDocumentAndUser,\n    [\n      req.params.documentId,\n      req.params.userId,\n    ]\n  ),\n    (error, results, fields) => {\n      if (error) {\n        console.log(error);\n        res.sendStatus(500);\n        return;\n      }\n      console.log(results);\n      res.json(results);\n    }\n  )\n})\n\n// delete highlight\nrouter.delete('/', (req, res) => {\n  if (req.body.userId == req.user.id) {\n    dbIniter.query(mysql.format(highlights.delete,\n      [\n        req.body.id,\n        req.body.documentId,\n        req.body.userId,\n      ]\n    ),\n      (error, results, fields) => {\n        if (error) {\n          console.log(error);\n          res.sendStatus(500);\n          return;\n        }\n        console.log(fields);\n        res.sendStatus(200);\n      }\n    )\n  } else {\n    res.sendStatus(403); // 403 Forbidden\n  }\n})\n\n// add highlights\nrouter.post('/', (req, res) => {\n  if (req.body.userId == req.user.id) {\n\n    // save highlight from body\n    dbIniter.query(mysql.format(highlights.insert,\n      [\n        req.body.id,\n        req.body.start,\n        req.body.end,\n        req.body.class,\n        req.body.container,\n        req.body.documentId,\n        req.body.userId,\n      ]\n    ),\n      (error, results, fields) => {\n        if (error) {\n          console.log(error);\n          res.sendStatus(500);\n          return;\n        }\n        console.log(results);\n        res.sendStatus(200);\n      }\n    )\n  } else {\n    res.sendStatus(403); // 403 Forbidden\n  }\n})\n\nexport default router;"]}