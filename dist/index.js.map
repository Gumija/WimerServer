{"version":3,"sources":["../src/index.js"],"names":["GOOGLE_CLIENT_ID","process","env","GOOGLE_CLIENT_SECRET","serializeUser","user","done","console","log","deserializeUser","obj","use","OAuth2Strategy","clientID","clientSecret","callbackURL","passReqToCallback","request","accessToken","refreshToken","profile","dbIniter","initDB","documents","insert","selectAll","selectById","update","highlights","delete","selectByDocumentAndUser","app","upload","dest","buildFolderPath","DATABASE_URL","resolve","__dirname","static","json","secret","name","proxy","resave","saveUninitialized","cookie","secure","initialize","session","get","authenticate","scope","failureRedirect","req","res","sessonIdName","id","sessionID","isAuthenticated","redirect","cookies","signedCookies","query","format","params","documentId","userId","error","results","fields","sendStatus","body","post","start","end","class","container","download","path","title","parseInt","field","single","file","originalname","mimetype","encoding","insertId","sendFile","set","PORT","listen"],"mappings":"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","file":"index.js","sourcesContent":["import bodyParser from 'body-parser';\nimport cookieParser from 'cookie-parser';\nimport express from 'express';\nimport session from 'express-session';\nimport morgan from 'morgan';\nimport mysql from 'mysql';\nimport multer from 'multer';\nimport passport from 'passport';\nimport GoogleAuth from 'passport-google-oauth';\nimport path from 'path';\nimport DbIniter from './db/db';\n\n// API Access link for creating client ID and secret:\n// https://code.google.com/apis/console/\nvar GOOGLE_CLIENT_ID = process.env.GOOGLE_CLIENT_ID\n  , GOOGLE_CLIENT_SECRET = process.env.GOOGLE_CLIENT_SECRET;\n\n// Passport session setup.\n//   To support persistent login sessions, Passport needs to be able to\n//   serialize users into and deserialize users out of the session.  Typically,\n//   this will be as simple as storing the user ID when serializing, and finding\n//   the user by ID when deserializing.  However, since this example does not\n//   have a database of user records, the complete Google profile is\n//   serialized and deserialized.\npassport.serializeUser(function (user, done) {\n  console.log('Serialize', user);\n  done(null, user);\n});\n\npassport.deserializeUser(function (obj, done) {\n  console.log('Deserialize', obj);\n  done(null, obj);\n});\n\n// Use the GoogleStrategy within Passport.\n//   Strategies in Passport require a `verify` function, which accept\n//   credentials (in this case, an accessToken, refreshToken, and Google\n//   profile), and invoke a callback with a user object.\npassport.use(new GoogleAuth.OAuth2Strategy({\n  clientID: GOOGLE_CLIENT_ID,\n  clientSecret: GOOGLE_CLIENT_SECRET,\n  callbackURL: \"http://morning-stream-82096.herokuapp.com/auth/google/callback\",\n  passReqToCallback: true\n},\n  function (request, accessToken, refreshToken, profile, done) {\n    // To keep the example simple, the user's Google profile is returned to\n    // represent the logged-in user.  In a typical application, you would want\n    // to associate the Google account with a user record in your database,\n    // and return that user instead.\n    console.log('Profile', profile)\n    return done(null, profile);\n  }\n));\n\nlet dbIniter = new DbIniter();\ndbIniter.initDB();\n\nlet documents = {\n  insert:\n  'INSERT INTO documents \\\n     VALUES (?, ?, ?, ?, ?)',\n  selectAll:\n  'SELECT * \\\n     FROM documents',\n  selectById:\n  'SELECT * \\\n     FROM documents \\\n     WHERE id = ?',\n  update:\n  'UPDATE documents \\\n     SET title = ? \\\n     WHERE id = ?',\n}\n\nlet highlights = {\n  insert:\n  'INSERT INTO highlights \\\n     VALUES (?, ?, ?, ?, ?, ?, ?)',\n  delete:\n  'DELETE FROM highlights \\\n     WHERE id = ? \\\n     AND document_id = ? \\\n     AND user_id = ?',\n  selectByDocumentAndUser:\n  'SELECT * \\\n     FROM highlights \\\n     WHERE document_id = ? \\\n     AND user_id = ?',\n}\n\nlet app = express();\nlet upload = multer({ dest: 'uploads/' });\n\nlet buildFolderPath = process.env.DATABASE_URL ? path.resolve(__dirname, './', 'WimerReact/build')\n  : path.resolve(__dirname, '..', 'WimerReact/build')\n// logger\napp.use(morgan(':remote-addr - :remote-user [:date[clf]] \":method :url HTTP/:http-version\" :status :res[content-length] :response-time ms'));\n// Serve static assets\napp.use(express.static(buildFolderPath));\napp.use(cookieParser('cookie_secret'));\napp.use(bodyParser.json());\napp.use(session({\n  secret: 'cookie_secret',\n  name: 'sessonIdName',\n  proxy: true,\n  resave: true,\n  saveUninitialized: true,\n  cookie: { secure: false }\n}));\napp.use(passport.initialize());\napp.use(passport.session());\n\n// GET /auth/google\n//   Use passport.authenticate() as route middleware to authenticate the\n//   request.  The first step in Google authentication will involve\n//   redirecting the user to google.com.  After authorization, Google\n//   will redirect the user back to this application at /auth/google/callback\napp.get('/auth/google', passport.authenticate('google', {\n  scope: [\n    'https://www.googleapis.com/auth/plus.login',\n    'https://www.googleapis.com/auth/plus.profile.emails.read']\n}));\n\n// GET /auth/google/callback\n//   Use passport.authenticate() as route middleware to authenticate the\n//   request.  If authentication fails, the user will be redirected back to the\n//   login page.  Otherwise, the primary route function function will be called,\n//   which, in this example, will redirect the user to the home page.\napp.get('/auth/google/callback',\n  passport.authenticate('google', { failureRedirect: '/login' }),\n  function (req, res) {\n    console.log('---------- AFTER LOGIN -----------')\n    console.log('SessionIdName: ', req.session.sessonIdName)\n    console.log('SessionId: ', req.session.id)\n    console.log('SessionId: ', req.sessionID)\n    console.log('SessionCookie: ', req.session.cookie)\n    console.log('Auth: ', req.isAuthenticated());\n    console.log('User: ', req.user);\n    res.redirect('/');\n  });\n\n//   app.get('/auth/google/callback', function(req, res, next) {\n//   passport.authenticate('google', function(err, user, info) {\n//     console.log('User', user);\n//     console.log('Info:', info);\n//     if (err) { console.log(err); return next(err); }\n//     if (!user) { console.log('No user'); return res.redirect('/'); }\n//     req.login(user, function(err) {\n//       if (err) { console.log(err); return next(err); }\n//       return res.redirect('/');\n//     });\n//   })(req, res, next);\n// });\n\n\n\n\napp.get('/highlight/:documentId/:userId', (req, res) => {\n  console.log('-------- HIGHLIGHT GET --------');\n  console.log('Session', req.session);\n  console.log('SessionIdName: ', req.session.sessonIdName)\n  console.log('Cookies: ', req.cookies)\n  console.log('Signed Cookies: ', req.signedCookies)\n  console.log('Auth: ', req.isAuthenticated());\n  console.log('User: ', req.user);\n  dbIniter.query(mysql.format(highlights.selectByDocumentAndUser,\n    [\n      req.params.documentId,\n      req.params.userId,\n    ]\n  ),\n    (error, results, fields) => {\n      if (error) {\n        console.log(error);\n        res.sendStatus(500);\n        return;\n      }\n      console.log(results);\n      res.json(results);\n    }\n  )\n})\n\napp.delete('/highlight', (req, res) => {\n  console.log('-------- HIGHLIGHT DELETE --------');\n  console.log('Session', req.session);\n  console.log('SessionIdName: ', req.session.sessonIdName)\n  console.log('Cookies: ', req.cookies)\n  console.log('Signed Cookies: ', req.signedCookies)\n  console.log('Auth: ', req.isAuthenticated());\n  console.log('User: ', req.user);\n  dbIniter.query(mysql.format(highlights.delete,\n    [\n      req.body.id,\n      req.body.documentId,\n      req.body.userId,\n    ]\n  ),\n    (error, results, fields) => {\n      if (error) {\n        console.log(error);\n        res.sendStatus(500);\n        return;\n      }\n      console.log(fields);\n      res.sendStatus(200);\n    }\n  )\n})\n\napp.post('/highlight', (req, res) => {\n  console.log('-------- HIGHLIGHT POST --------');\n  console.log('Session', req.session);\n  console.log('SessionIdName: ', req.session.sessonIdName)\n  console.log('Cookies: ', req.cookies)\n  console.log('Signed Cookies: ', req.signedCookies)\n  console.log('Auth: ', req.isAuthenticated());\n  console.log('User: ', req.user);\n  // save highlight from body\n  dbIniter.query(mysql.format(highlights.insert,\n    [\n      req.body.id,\n      req.body.start,\n      req.body.end,\n      req.body.class,\n      req.body.container,\n      req.body.documentId,\n      req.body.userId,\n    ]\n  ),\n    (error, results, fields) => {\n      if (error) {\n        console.log(error);\n        res.sendStatus(500);\n        return;\n      }\n      console.log(results);\n      res.sendStatus(200);\n    }\n  )\n})\n\napp.get('/documents/download/:id', (req, res) => {\n  console.log('-------- DOCUMENTS DOWNLOAD ID--------');\n  console.log('Session', req.session);\n  console.log('SessionIdName: ', req.session.sessonIdName)\n  console.log('Cookies: ', req.cookies)\n  console.log('Signed Cookies: ', req.signedCookies)\n  console.log('Auth: ', req.isAuthenticated());\n  console.log('User: ', req.user);\n  console.log(mysql.format(documents.selectById, [req.params.id]));\n  dbIniter.query(mysql.format(documents.selectById, [req.params.id]),\n    (error, results, fields) => {\n      if (error) {\n        console.log(error);\n        res.sendStatus(500);\n        return;\n      }\n      console.log(results);\n      res.download(results[0].path);\n    }\n  )\n})\n\napp.post('/documents/update/:id', (req, res) => {\n  console.log('-------- DOCUMENTS UPDATE ID --------');\n  console.log('Session', req.session);\n  console.log('SessionIdName: ', req.session.sessonIdName)\n  console.log('Cookies: ', req.cookies)\n  console.log('Signed Cookies: ', req.signedCookies)\n  console.log('Auth: ', req.isAuthenticated());\n  console.log('User: ', req.user);\n  dbIniter.query(mysql.format(documents.update, [req.body.title, req.params.id]),\n    (error, results, fields) => {\n      if (error) {\n        console.log(error);\n        res.sendStatus(500);\n        return;\n      }\n      console.log(results);\n      res.json(results);\n    }\n  )\n})\n\napp.get('/documents/:id', (req, res) => {\n  console.log('-------- DOCUMENTS ID --------');\n  console.log('Session', req.session);\n  console.log('SessionIdName: ', req.session.sessonIdName)\n  console.log('Cookies: ', req.cookies)\n  console.log('Signed Cookies: ', req.signedCookies)\n  console.log('Auth: ', req.isAuthenticated());\n  console.log('User: ', req.user);\n  dbIniter.query(mysql.format(documents.selectById, [parseInt(req.params.id, 10)]),\n    (error, results, fields) => {\n      if (error) {\n        console.log(error);\n        res.sendStatus(500);\n        return;\n      }\n      console.log(results);\n      res.json(results);\n    }\n  )\n})\n\napp.get('/documents',\n  passport.authenticate('google', { failureRedirect: '/login' }),\n  (req, res) => {\n    console.log('-------- DOCUMENTS --------');\n    console.log('Session', req.session);\n    console.log('SessionIdName: ', req.session.sessonIdName)\n    console.log('SessionId: ', req.session.id)\n    console.log('SessionId: ', req.sessionID)\n    console.log('SessionCookie: ', req.session.cookie)\n    console.log('Cookies: ', req.cookies)\n    console.log('Signed Cookies: ', req.signedCookies)\n    console.log('Auth: ', req.isAuthenticated());\n    console.log('User: ', req.user);\n    dbIniter.query(documents.selectAll,\n      (error, results, field) => {\n        if (error) {\n          console.log(error);\n          res.sendStatus(500);\n          return;\n        }\n        console.log(results);\n        res.json(results);\n      }\n    )\n  })\n\napp.post('/upload', upload.single('doc'), (req, res) => {\n  let file = req.file;\n  // save document info to db\n  dbIniter.query(mysql.format(documents.insert,\n    [\n      0,\n      file.originalname,\n      file.path,\n      file.mimetype,\n      file.encoding,\n    ]),\n    (error, results, fields) => {\n      if (error) {\n        console.log(error);\n        res.sendStatus(500);\n        return;\n      }\n      console.log(results);\n      res.json({ id: results.insertId });\n    }\n  )\n})\n\n// Always return the main index.html, so react-router render the route in the client\napp.get('*', (req, res) => {\n  console.log('------ Session', req.session);\n  console.log(\"dirname:\", __dirname)\n  console.log('--------- INDEX.HTML path:', path.resolve(__dirname, '..', 'WimerReact/build', 'index.html'));\n  console.log('--------- INDEX.HTML path:', path.resolve(__dirname, './', 'WimerReact/build', 'index.html'));\n  if (process.env.DATABASE_URL) {\n    res.sendFile(path.resolve(buildFolderPath, 'index.html'));\n  } else {\n    res.sendFile(path.resolve(buildFolderPath, 'index.html'));\n  }\n});\n\napp.set('port', (process.env.PORT || 3001));\n\napp.listen(app.get('port'), () => {\n  console.log(`App listening on port ${app.get(\"port\")}!`);\n});"]}