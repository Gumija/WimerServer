{"version":3,"sources":["../../src/db/db.js"],"names":["DbInitializer","connection","initDB","connect","initSchema","query","changeUser","database","err","initTables","console","log","end","queryString","nextQuery","sql","error","results","fields"],"mappings":";;;;;;;;IACqBA,a,GAEnB,uBAAYC,UAAZ,EAAwB;AAAA;;AAAA;;AAAA,OAGxBC,MAHwB,GAGf,YAAM;AACb,UAAKD,UAAL,CAAgBE,OAAhB;AACA,UAAKC,UAAL;AACD,GANuB;;AAAA,OAQxBA,UARwB,GAQX,YAAM;AACjB,UAAKC,KAAL,CAAW,qCAAX;AACA,UAAKJ,UAAL,CAAgBK,UAAhB,CAA2B,EAAEC,UAAU,OAAZ,EAA3B,EAAkD,UAACC,GAAD,EAAS;AACzD,UAAIA,GAAJ,EAAS,MAAMA,GAAN;AACT,YAAKC,UAAL;AACD,KAHD;AAID,GAduB;;AAAA,OAgBxBA,UAhBwB,GAgBX,YAAM;AACjBC,YAAQC,GAAR,CAAY,aAAZ;AACA,UAAKN,KAAL,CAAW;;;;;;;;2CAAX,EASE;AAAA,aAAM,MAAKA,KAAL,CAAW;;;;;;;;;;6CAAX,EAWJ;AAAA,eAAM,MAAKA,KAAL,CAAW;;;;;;;4CAAX,EAQJ,YAAM;AACJ,gBAAKJ,UAAL,CAAgBW,GAAhB;AACAF,kBAAQC,GAAR,CAAY,oBAAZ;AACD,SAXG,CAAN;AAAA,OAXI,CAAN;AAAA,KATF;AAkCD,GApDuB;;AAAA,OAsDxBN,KAtDwB,GAsDhB,UAACQ,WAAD,EAAcC,SAAd,EAA4B;AAClC,UAAKb,UAAL,CAAgBI,KAAhB,CAAsB,EAAEU,KAAKF,WAAP,EAAtB,EAA4C,UAACG,KAAD,EAAQC,OAAR,EAAiBC,MAAjB,EAA4B;AACtE,UAAIF,KAAJ,EAAWN,QAAQC,GAAR,CAAYK,KAAZ;AACX,UAAIF,SAAJ,EAAeA;AAChB,KAHD;AAID,GA3DuB;;AACtB,OAAKb,UAAL,GAAkBA,UAAlB;AACD,C;;kBAJkBD,a","file":"db.js","sourcesContent":["\nexport default class DbInitializer {\n\n  constructor(connection) {\n    this.connection = connection;\n  }\n  initDB = () => {\n    this.connection.connect();  \n    this.initSchema();\n  }\n\n  initSchema = () => {\n    this.query(\"CREATE DATABASE IF NOT EXISTS wimer\");\n    this.connection.changeUser({ database: 'wimer' }, (err) => {\n      if (err) throw err;\n      this.initTables();\n    });\n  }\n\n  initTables = () => {\n    console.log('Initing db.')\n    this.query(\"\\\n      CREATE TABLE IF NOT EXISTS `documents` (\\\n      `id` int(11) NOT NULL AUTO_INCREMENT,\\\n      `title` varchar(255) NOT NULL,\\\n      `path` varchar(512) NOT NULL,\\\n      `type` varchar(45) NOT NULL,\\\n      `encoding` varchar(45) NOT NULL,\\\n      PRIMARY KEY (`id`)\\\n    ) ENGINE=InnoDB DEFAULT CHARSET=latin1\",\n      () => this.query(\"\\\n      CREATE TABLE IF NOT EXISTS `highlights` (\\\n      `id` int(11) NOT NULL AUTO_INCREMENT,\\\n      `start` int(11) NOT NULL,\\\n      `end` int(11) NOT NULL,\\\n      `class` varchar(45) NOT NULL,\\\n      `container` varchar(45) NOT NULL,\\\n      `document_id` int(11) NOT NULL,\\\n      `user_id` int(11) NOT NULL,\\\n      PRIMARY KEY (`id`,`document_id`,`user_id`)\\\n    ) ENGINE=InnoDB  DEFAULT CHARSET=latin1;\",\n        () => this.query(\"\\\n      CREATE TABLE IF NOT EXISTS `users` (\\\n      `id` int(11) NOT NULL AUTO_INCREMENT,\\\n      `name` varchar(255) NOT NULL,\\\n      `email` varchar(255) NOT NULL,\\\n      `google_id` varchar(45) NOT NULL,\\\n      PRIMARY KEY (`id`)\\\n    ) ENGINE=InnoDB DEFAULT CHARSET=latin1;\",\n          () => {\n            this.connection.end();\n            console.log('Initiing finished!');\n          }\n        )));\n\n  }\n\n  query = (queryString, nextQuery) => {\n    this.connection.query({ sql: queryString }, (error, results, fields) => {\n      if (error) console.log(error);\n      if (nextQuery) nextQuery();\n    })\n  }\n}"]}