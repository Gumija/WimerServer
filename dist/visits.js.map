{"version":3,"sources":["../src/visits.js"],"names":["visits","insert","selectByUserId","router","Router","post","req","res","user","console","log","params","body","format","id","documentId","userId","Date","query","error","results","field","sendStatus","get","json"],"mappings":";;;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAIA,SAAS;AACXC,UACA;;oCAFW;AAKXC,kBACA;;;;;;AANW,CAAb;;AAcA,IAAIC,SAAS,kBAAQC,MAAR,EAAb;;AAEAD,OAAOE,IAAP,CAAY,sBAAZ,EAAoC,UAACC,GAAD,EAAMC,GAAN,EAAc;AAChD,MAAID,IAAIE,IAAR,EAAc;AACZC,YAAQC,GAAR,CAAY,UAAZ,EAAwBJ,IAAIK,MAA5B;AACAF,YAAQC,GAAR,CAAY,QAAZ,EAAsBJ,IAAIM,IAA1B;AACAH,YAAQC,GAAR,CAAY,gBAAMG,MAAN,CAAab,OAAOC,MAApB,EAA4B,CACtCK,IAAIE,IAAJ,CAASM,EAD6B,EAEtCR,IAAIK,MAAJ,CAAWI,UAF2B,EAGtCT,IAAIK,MAAJ,CAAWK,MAH2B,EAItC,IAAIC,IAAJ,EAJsC,EAKtC,IAAIA,IAAJ,EALsC,CAA5B,CAAZ;AAOA,iBAASC,KAAT,CAAe,gBAAML,MAAN,CAAab,OAAOC,MAApB,EAA4B,CACzCK,IAAIE,IAAJ,CAASM,EADgC,EAEzCR,IAAIK,MAAJ,CAAWI,UAF8B,EAGzCT,IAAIK,MAAJ,CAAWK,MAH8B,EAIzC,IAAIC,IAAJ,EAJyC,EAKzC,IAAIA,IAAJ,EALyC,CAA5B,CAAf,EAOE,UAACE,KAAD,EAAQC,OAAR,EAAiBC,KAAjB,EAA2B;AACzB,UAAIF,KAAJ,EAAW;AACTV,gBAAQC,GAAR,CAAYS,KAAZ;AACAZ,YAAIe,UAAJ,CAAe,GAAf;AACA;AACD;AACDb,cAAQC,GAAR,CAAYU,OAAZ;AACAb,UAAIe,UAAJ,CAAe,GAAf;AACD,KAfH;AAiBD,GA3BD,MA2BO;AACLf,QAAIe,UAAJ,CAAe,GAAf,EADK,CACgB;AACtB;AACF,CA/BD;;AAiCAnB,OAAOoB,GAAP,CAAW,GAAX,EAAgB,UAACjB,GAAD,EAAMC,GAAN,EAAc;AAC5B,MAAID,IAAIE,IAAR,EAAc;AACZ,iBAASU,KAAT,CAAe,gBAAML,MAAN,CAAab,OAAOE,cAApB,EAAoC,CAACI,IAAIE,IAAJ,CAASM,EAAV,CAApC,CAAf,EACE,UAACK,KAAD,EAAQC,OAAR,EAAiBC,KAAjB,EAA2B;AACzB,UAAIF,KAAJ,EAAW;AACTV,gBAAQC,GAAR,CAAYS,KAAZ;AACAZ,YAAIe,UAAJ,CAAe,GAAf;AACA;AACD;AACDb,cAAQC,GAAR,CAAYU,OAAZ;AACAb,UAAIiB,IAAJ,CAASJ,OAAT;AACD,KATH;AAWD,GAZD,MAYO;AACLb,QAAIiB,IAAJ,CAAS,EAAT;AACD;AACF,CAhBD;;kBAkBerB,M","file":"visits.js","sourcesContent":["\nimport express from 'express';\nimport dbIniter from './db/db';\nimport mysql from 'mysql';\n\nlet visits = {\n  insert:\n  'INSERT INTO visits \\\n   VALUES (?, ?, ?, ?) \\\n   ON DUPLICATE KEY UPDATE date = ?',\n  selectByUserId:\n  'SELECT v.document_id, v.document_user_id, v.date , d.title \\\n   FROM visits v\\\n   JOIN documents d ON v.document_id = d.id \\\n\t\t\t\t\t\t\t\t\t\tAND v.document_user_id = d.user_id\\\n   WHERE v.user_id = ? \\\n   ORDER BY v.date DESC;'\n}\n\nlet router = express.Router();\n\nrouter.post('/:documentId/:userId', (req, res) => {\n  if (req.user) {\n    console.log('PARAMS: ', req.params)\n    console.log('BODY: ', req.body)\n    console.log(mysql.format(visits.insert, [\n      req.user.id,\n      req.params.documentId,\n      req.params.userId,\n      new Date(),\n      new Date(),\n    ]));\n    dbIniter.query(mysql.format(visits.insert, [\n      req.user.id,\n      req.params.documentId,\n      req.params.userId,\n      new Date(),\n      new Date(),\n    ]),\n      (error, results, field) => {\n        if (error) {\n          console.log(error);\n          res.sendStatus(500);\n          return;\n        }\n        console.log(results);\n        res.sendStatus(200);\n      }\n    )\n  } else {\n    res.sendStatus(403); // 403 Forbidden\n  }\n})\n\nrouter.get('/', (req, res) => {\n  if (req.user) {\n    dbIniter.query(mysql.format(visits.selectByUserId, [req.user.id]),\n      (error, results, field) => {\n        if (error) {\n          console.log(error);\n          res.sendStatus(500);\n          return;\n        }\n        console.log(results);\n        res.json(results);\n      }\n    )\n  } else {\n    res.json({});\n  }\n})\n\nexport default router;"]}